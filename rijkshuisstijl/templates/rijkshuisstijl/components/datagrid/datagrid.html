{% load l10n rijkshuisstijl %}{% singleline %}
    <div class="datagrid{% if class %} {{ class }}{% endif %}" id="{{ id }}" role="group">

        {# This (filter) form is located outside the datagrid to avoid conflict with selection form. #}
        {% if filters %}
            <form id="datagrid-filter-form-{{ id }}" method="GET">
                {% firstof ordering_key 'ordering' as ordering_key %}

                {% if request.GET|get:ordering_key %}
                    <input type="hidden" name="{{ ordering_key }}" value="{{ request.GET|get:ordering_key }}">
                {% endif %}

                <input class="input input--hidden" type="submit">
            </form>
        {% endif %}

        {# This (paginator) form is located outside the datagrid to avoid conflict with selection form. #}
        {% if is_paginated %}
            <form id="datagrid-paginator-form-{{ id }}" method="GET">
                {% firstof ordering_key 'ordering' as ordering_key %}

                {% if request.GET|get:ordering_key %}
                    <input type="hidden" name="{{ ordering_key }}" value="{{ request.GET|get:ordering_key }}">
                {% endif %}

                {% for filter in filters %}
                    {% form_input type='hidden' name=filter.key value=filter.value %}
                {% endfor %}

                <input class="input input--hidden" type="submit">
            </form>
        {% endif %}

        {% if form %}
          <form class="datagrid__form" method="{{ form_method }}"{% if form_action %} action="{{ form_action }}"{% endif %}>

            {% if form_method|upper != "GET" %}
              {% csrf_token %}
            {% endif %}
        {% endif %}

        {% if title or form and form_select_all_position in 'top,both' or form_buttons and toolbar_position in 'top,both' or dom_filter %}
            <header class="datagrid__header">
                <div class="toolbar toolbar--justify toolbar--pad">
                    <ul class="toolbar__list">
                        {% if title %}
                            <li class="toolbar__list-item">
                                <h4 class="datagrid__title">{{ title }}</h4>
                            </li>
                        {% endif %}

                        {% if form %}
                            <li class="toolbar__list-item">
                                <th class="datagrid__caption datagrid__caption--checkbox">
                                    {% if form_select_all_position in 'top,both' %}
                                        {% include 'rijkshuisstijl/components/datagrid/datagrid-select-all.html' with id=id form_select_all_position='top' label_select_all=label_select_all only %}
                                    {% endif %}
                                </th>
                            </li>
                        {% endif %}

                        {% if form_buttons and toolbar_position in 'top,both' %}
                            <li class="toolbar__list-item">
                                {% include 'rijkshuisstijl/components/datagrid/datagrid-actions.html' with form_buttons=form_buttons form_select=form_select only %}
                            </li>
                        {% endif %}
                    </ul>

                    <ul class="toolbar__list">
                        {% if dom_filter %}
                            <li class="toolbar__list-item">
                                {% dom_filter class='filter--class-only' input_class='input--contrast input--light' filter_target='#'|add:id|add:' tbody tr' label_placeholder=label_filter_placeholder %}
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </header>
        {% endif %}

        <div class="datagrid__body">
            <table class="datagrid__table">
                <thead class="datagrid__table-header">
                <tr class="datagrid__row datagrid__row--captions">
                    {% for column in columns %}
                        {% if column.key in ordering %}
                            {% with ordering|get:column.key as ordering %}
                                <th class="datagrid__caption datagrid__caption--{{ column.key }} datagrid__caption--orderable{% if ordering.direction %} datagrid__caption--ordered-{{ ordering.direction }}{% endif %}"
                                        {% if form and forloop.counter is 1 %} colspan="2"{% endif %}
                                        {% if column.width %} style="width: {{ column.width }};"{% endif %}>
                                    <a class="datagrid__link" href="{{ ordering.url }}">{{ column.label }}</a>
                                    <span class="datagrid__icon"></span>
                                </th>
                            {% endwith %}
                        {% else %}
                            <th class="datagrid__caption datagrid--{{ column.key }}"
                                    {% if column.width %} style="width: {{ column.width }};"{% endif %}>{{ column.label }}</th>
                        {% endif %}
                    {% endfor %}
                </tr>

                {% if filters %}
                    <tr class="datagrid__row datagrid__row--filters">
                        {% for column in columns %}
                            <th class="datagrid__filter datagrid__filter--{{ column.key }}"
                                    {% if form and forloop.counter is 1 %} colspan="2"{% endif %}>
                                {% for filter in filters %}
                                    {% if filter.key == column.key %}
                                        {% if filter.type == 'DateField' or filter.type == 'DateTimeField' %}
                                            {% form_input class='input--light' type='date' name=filter.key value=filter.value placeholder=column.label form_id='datagrid-filter-form-'|add:id %}
                                        {% elif filter.choices %}
                                            {% form_select class='select--light' id='datagrid-filter-'|add:filter.key|add:'-'|add:id name=filter.key value=filter.value choices=filter.choices form_id='datagrid-filter-form-'|add:id %}
                                        {% else %}
                                            {% form_input class='input--light' type="search" id='datagrid-filter-'|add:filter.key|add:'-'|add:id name=filter.key value=filter.value choices=filter.choices placeholder=column.label form_id='datagrid-filter-form-'|add:id %}
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            </th>
                        {% endfor %}
                    </tr>
                {% endif %}
                </thead>

                {% for group in groups %}
                    {% include 'rijkshuisstijl/components/datagrid/datagrid-table-body.html' with columns=columns form=form form_checkbox_name=form_checkbox_name group=group label_no_results=label_no_results modifier_column=modifier_column url_reverse=url_reverse only %}
                {% endfor %}
            </table>
        </div>

        {% if is_paginated or form and form_select_all_position in 'bottom,both' %}
            <footer class="datagrid__footer">
                <div class="toolbar toolbar--justify toolbar--pad">
                    <ul class="toolbar__list">
                        {% if form %}
                            <li class="toolbar__list-item">
                                <th class="datagrid__caption datagrid__caption--checkbox">
                                    {% if form_select_all_position in 'bottom,both' %}
                                        {% include 'rijkshuisstijl/components/datagrid/datagrid-select-all.html' with id=id form_select_all_position='bottom' label_select_all=label_select_all only %}
                                    {% endif %}
                                </th>
                            </li>
                        {% endif %}

                        {% if form_buttons and toolbar_position in 'bottom,both' %}
                            <li class="toolbar__list-item">
                                {% include 'rijkshuisstijl/components/datagrid/datagrid-actions.html' with form_buttons=form_buttons form_select=form_select only %}
                            </li>
                        {% endif %}
                    </ul>
                    <ul class="toolbar__list">
                        {% if is_paginated %}
                            <li class="toolbar__list-item datagrid__result-count">{{ paginator.count }} {{ label_result_count }}</li>
                            <li class="toolbar__list-item">{% paginator is_paginated=is_paginated paginator=paginator page_key=page_key page_number=page_number page_obj=page_obj form='datagrid-paginator-form-'|add:id %}</li>
                        {% endif %}
                    </ul>
                </div>
            </footer>
        {% elif form_buttons and toolbar_position in 'bottom,both' %}
            <footer class="datagrid__footer">
                <div class="toolbar toolbar--pad{% if form_buttons and toolbar_position in 'bottom,both' %} toolbar--justify{% else %} toolbar--align-right{% endif %}">
                    {% include 'rijkshuisstijl/components/datagrid/datagrid-actions.html' with form_buttons=form_buttons form_select=form_select only %}
                </div>
            </footer>
        {% endif %}

        {% if form %}
            </form>
        {% endif %}
    </div>
{% endsingleline %}
